



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
        <link rel="canonical" href="http://netflix.github.io/spectator/intro/servo-comparison/">
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0, mkdocs-material-3.0.3">
    
    
      
        <title>Servo Comparison - Spectator Docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.451f80e5.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
      <link rel="stylesheet" href="../../css/custom.css">
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="../../#servo-comparison" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="http://netflix.github.io/spectator" title="Spectator Docs" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Spectator Docs
              </span>
              <span class="md-header-nav__topic">
                Servo Comparison
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/Netflix/spectator/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="http://netflix.github.io/spectator" title="Spectator Docs" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Spectator Docs
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/Netflix/spectator/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Getting Started
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Getting Started
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../registry/" title="Registry" class="md-nav__link">
      Registry
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-2" type="checkbox" id="nav-2-2">
    
    <label class="md-nav__link" for="nav-2-2">
      Meter Types
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-2">
        Meter Types
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../counter/" title="Counters" class="md-nav__link">
      Counters
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../timer/" title="Timers" class="md-nav__link">
      Timers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../gauge/" title="Gauges" class="md-nav__link">
      Gauges
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dist-summary/" title="Distribution Summaries" class="md-nav__link">
      Distribution Summaries
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../clock/" title="Clock" class="md-nav__link">
      Clock
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../conventions/" title="Naming Conventions" class="md-nav__link">
      Naming Conventions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../testing/" title="Testing" class="md-nav__link">
      Testing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../netflix/" title="Netflix Integration" class="md-nav__link">
      Netflix Integration
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Servo Comparison
      </label>
    
    <a href="./" title="Servo Comparison" class="md-nav__link md-nav__link--active">
      Servo Comparison
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#differences" title="Differences" class="md-nav__link">
    Differences
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#simpler-api" title="Simpler API" class="md-nav__link">
    Simpler API
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#more-focused" title="More Focused" class="md-nav__link">
    More Focused
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#di-friendly" title="DI Friendly" class="md-nav__link">
    DI Friendly
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#migration" title="Migration" class="md-nav__link">
    Migration
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#registration" title="Registration" class="md-nav__link">
    Registration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#annotations" title="Annotations" class="md-nav__link">
    Annotations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#basiccounter" title="BasicCounter" class="md-nav__link">
    BasicCounter
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#basicgauge" title="BasicGauge" class="md-nav__link">
    BasicGauge
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#basictimer" title="BasicTimer" class="md-nav__link">
    BasicTimer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#basicdistributionsummary" title="BasicDistributionSummary" class="md-nav__link">
    BasicDistributionSummary
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#basicinformational" title="BasicInformational" class="md-nav__link">
    BasicInformational
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#basicstopwatch" title="BasicStopwatch" class="md-nav__link">
    BasicStopwatch
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#buckettimer" title="BucketTimer" class="md-nav__link">
    BucketTimer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#contextualcounter" title="ContextualCounter" class="md-nav__link">
    ContextualCounter
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#contextualtimer" title="ContextualTimer" class="md-nav__link">
    ContextualTimer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#doublegauge" title="DoubleGauge" class="md-nav__link">
    DoubleGauge
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#durationtimer" title="DurationTimer" class="md-nav__link">
    DurationTimer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamiccounter" title="DynamicCounter" class="md-nav__link">
    DynamicCounter
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamictimer" title="DynamicTimer" class="md-nav__link">
    DynamicTimer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#longgauge" title="LongGauge" class="md-nav__link">
    LongGauge
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#monitorconfig" title="MonitorConfig" class="md-nav__link">
    MonitorConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#monitoredcache" title="MonitoredCache" class="md-nav__link">
    MonitoredCache
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numbergauge" title="NumberGauge" class="md-nav__link">
    NumberGauge
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#statstimer" title="StatsTimer" class="md-nav__link">
    StatsTimer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stepcounter" title="StepCounter" class="md-nav__link">
    StepCounter
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Extensions
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Extensions
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-1" type="checkbox" id="nav-3-1">
    
    <label class="md-nav__link" for="nav-3-1">
      JVM Stats
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-1">
        JVM Stats
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../ext/jvm-buffer-pools/" title="Buffer Pools" class="md-nav__link">
      Buffer Pools
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ext/jvm-gc/" title="Garbage Collection" class="md-nav__link">
      Garbage Collection
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ext/jvm-gc-causes/" title="GC Causes" class="md-nav__link">
      GC Causes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ext/jvm-memory-pools/" title="Memory Pools" class="md-nav__link">
      Memory Pools
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ext/thread-pools/" title="Thread Pools" class="md-nav__link">
      Thread Pools
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ext/log4j2/" title="Log4j2 Appender" class="md-nav__link">
      Log4j2 Appender
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ext/log4j1/" title="Log4j1 Appender" class="md-nav__link">
      Log4j1 Appender
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ext/placeholders/" title="Placeholders" class="md-nav__link">
      Placeholders
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Registries
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Registries
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../registry/metrics3/" title="Metrics3" class="md-nav__link">
      Metrics3
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../registry/servo/" title="Servo" class="md-nav__link">
      Servo
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../reports/" title="Build Reports" class="md-nav__link">
      Build Reports
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#differences" title="Differences" class="md-nav__link">
    Differences
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#simpler-api" title="Simpler API" class="md-nav__link">
    Simpler API
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#more-focused" title="More Focused" class="md-nav__link">
    More Focused
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#di-friendly" title="DI Friendly" class="md-nav__link">
    DI Friendly
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#migration" title="Migration" class="md-nav__link">
    Migration
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#registration" title="Registration" class="md-nav__link">
    Registration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#annotations" title="Annotations" class="md-nav__link">
    Annotations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#basiccounter" title="BasicCounter" class="md-nav__link">
    BasicCounter
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#basicgauge" title="BasicGauge" class="md-nav__link">
    BasicGauge
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#basictimer" title="BasicTimer" class="md-nav__link">
    BasicTimer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#basicdistributionsummary" title="BasicDistributionSummary" class="md-nav__link">
    BasicDistributionSummary
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#basicinformational" title="BasicInformational" class="md-nav__link">
    BasicInformational
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#basicstopwatch" title="BasicStopwatch" class="md-nav__link">
    BasicStopwatch
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#buckettimer" title="BucketTimer" class="md-nav__link">
    BucketTimer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#contextualcounter" title="ContextualCounter" class="md-nav__link">
    ContextualCounter
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#contextualtimer" title="ContextualTimer" class="md-nav__link">
    ContextualTimer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#doublegauge" title="DoubleGauge" class="md-nav__link">
    DoubleGauge
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#durationtimer" title="DurationTimer" class="md-nav__link">
    DurationTimer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamiccounter" title="DynamicCounter" class="md-nav__link">
    DynamicCounter
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamictimer" title="DynamicTimer" class="md-nav__link">
    DynamicTimer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#longgauge" title="LongGauge" class="md-nav__link">
    LongGauge
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#monitorconfig" title="MonitorConfig" class="md-nav__link">
    MonitorConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#monitoredcache" title="MonitoredCache" class="md-nav__link">
    MonitoredCache
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numbergauge" title="NumberGauge" class="md-nav__link">
    NumberGauge
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#statstimer" title="StatsTimer" class="md-nav__link">
    StatsTimer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stepcounter" title="StepCounter" class="md-nav__link">
    StepCounter
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/Netflix/spectator/edit/master/docs/intro/servo-comparison.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="servo-comparison">Servo Comparison<a class="headerlink" href="#servo-comparison" title="Permanent link">&para;</a></h1>
<p><a href="https://github.com/Netflix/servo">Servo</a> is an alternative client monitoring
library that is also developed by Netflix. Originally spectator was an
experiment for a simpler API that wrapped servo. It was done as a separate
project to avoid breaking backwards compatibility for servo.</p>
<p>From a user perspective, both will be supported for a long time, but most
of our efforts for future improvement will go to spectator. For new code it
is recommended to use the spectator API. If running
<a href="../netflix/">at Netflix</a> the correct bindings will be in place
for both servo and spectator.</p>
<h2 id="differences">Differences<a class="headerlink" href="#differences" title="Permanent link">&para;</a></h2>
<p>This section provides a quick summary of the differences.</p>
<h3 id="simpler-api">Simpler API<a class="headerlink" href="#simpler-api" title="Permanent link">&para;</a></h3>
<p>Servo gives the user a lot of control, but this makes it hard to use
correctly. For example, to create a counter the user needs to understand
the tradeoffs and choose between:</p>
<ul>
<li><a href="#basiccounter">BasicCounter</a></li>
<li><a href="#dynamiccounter">DynamicCounter</a></li>
<li><a href="#contextualcounter">ContextualCounter</a></li>
<li><a href="#stepcounter">StepCounter</a></li>
</ul>
<p>Further each of these can impact how data is reported to observers. The
spectator API focuses on the constructs a user needs to instrument the
code. In spectator the user would always use the registry to create a
<a href="../counter/">Counter</a>. The implementation details are left up to the
registry.</p>
<p>The <a href="#registration">registration</a> is simpler as well to avoid common pitfalls
when using servo like overwriting a registered object.</p>
<h3 id="more-focused">More Focused<a class="headerlink" href="#more-focused" title="Permanent link">&para;</a></h3>
<p>The goal of spectator is instrumenting code to send to a dimensional
time-series system like <a href="https://github.com/Netflix/atlas/wiki">Atlas</a>.
Servo has goals of staying compatible with a number of legacy libraries
and naming formats, exposing data to JMX, etc. Examples of how this
influences decisions:</p>
<ul>
<li>No support for non-numeric data. Servo supported this for exposing to JMX.
  Exposing the numeric data registered in spectator to JMX can be done
  using a registry that supports it, but there is no goal to be a general
  interface for exposing arbitrary data in JMX.</li>
<li>No support for customizeable time units when reporting timer data. Base
  units should always be used for reporting and conversions can be performed
  in the presentation layer if needed. It also avoids a lot of the confusion
  around the timer unit for the data and issues like creating aggregates that
  are meaningless because of mixed units.</li>
</ul>
<p>It is better to have a simple way to get correct and easy to reason about
data to the backend than many options. If you want more knobs, then you can use
Servo.</p>
<h3 id="di-friendly">DI Friendly<a class="headerlink" href="#di-friendly" title="Permanent link">&para;</a></h3>
<p>When servo was originally written dependency injection was not heavily used
at Netflix. Further servo needed to stay compatible with a number of use-cases
that were heavily static.</p>
<p>While spectator does have a static registry that can be used, the recommended
way is to create a registry and inject it either manually or via a framework
into the classes that need it. This also makes it much easier to
<a href="../testing/">test in isolation</a>.</p>
<h2 id="migration">Migration<a class="headerlink" href="#migration" title="Permanent link">&para;</a></h2>
<p>If you want to migrate from the servo API to the spectator API, then this
section provides some guides on how servo constructs can be ported over. The
sub-sections are the class names of monitor types supported by servo.</p>
<p>For users at Netflix, note we are not actively pushing teams to migrate
or do any additional work. Servo is still supported and if it works for your
use-cases feel free to continue using it. </p>
<h3 id="registration">Registration<a class="headerlink" href="#registration" title="Permanent link">&para;</a></h3>
<p>First read through the <a href="https://github.com/Netflix/servo/wiki/Getting-Started#registration-of-metrics">servo docs on registration</a>.
In servo if you have a class like:</p>
<div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="n">AtomicInteger</span> <span class="n">gauge</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">Counter</span> <span class="n">counter</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">Foo</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">gauge</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AtomicInteger</span><span class="o">();</span>
    <span class="n">counter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BasicCounter</span><span class="o">(</span><span class="n">MonitorConfig</span><span class="o">.</span><span class="na">builder</span><span class="o">(</span><span class="s">&quot;counter&quot;</span><span class="o">).</span><span class="na">build</span><span class="o">());</span>
    <span class="n">Monitors</span><span class="o">.</span><span class="na">registerObject</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="k">this</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Monitor</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;gauge&quot;</span><span class="o">,</span> <span class="n">type</span> <span class="o">=</span> <span class="n">DataSourceType</span><span class="o">.</span><span class="na">GAUGE</span><span class="o">)</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="nf">gauge</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">gauge</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doSomething</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">...</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>The state of the class is in the member variables of an instance of <code>Foo</code>.
If multiple instances of class <code>Foo</code> are created with the same value for <code>id</code>,
then the last one will overwrite the others for the registration. So the
values getting reported will only be from the last instance registered. Also
the registry has a reference to the instance of <code>Foo</code> so it will never go
away.</p>
<p>For counters and timers one way to get around this is to use
<a href="#dynamiccounter">DynamicCounter</a> and <a href="#dynamictimer">DynamicTimer</a>
respectively. Those classes will automatically handle the registration and
expire if there is no activity. They also get used for cases where the set
of dimensions is not known up front.</p>
<p>Gauges need to sample the state of something so they need to have a reference
to an object that contains the state. So the user would need to ensure that
only a single copy was registered leading to patterns like:</p>
<div class="codehilite"><pre><span></span><span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">FooStats</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">AtomicInteger</span> <span class="n">gauge</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Counter</span> <span class="n">counter</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">FooStats</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">gauge</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AtomicInteger</span><span class="o">();</span>
      <span class="n">counter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BasicCounter</span><span class="o">(</span><span class="n">MonitorConfig</span><span class="o">.</span><span class="na">builder</span><span class="o">(</span><span class="s">&quot;counter&quot;</span><span class="o">).</span><span class="na">build</span><span class="o">());</span>
      <span class="n">Monitors</span><span class="o">.</span><span class="na">registerObject</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="k">this</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Monitor</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;gauge&quot;</span><span class="o">,</span> <span class="n">type</span> <span class="o">=</span> <span class="n">DataSourceType</span><span class="o">.</span><span class="na">GAUGE</span><span class="o">)</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="nf">gauge</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">gauge</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="kd">private</span> <span class="kd">static</span> <span class="n">ConcurrentHashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">FooStats</span><span class="o">&gt;</span> <span class="n">STATS</span> <span class="o">=</span>
    <span class="k">new</span> <span class="n">ConcurrentHashMap</span><span class="o">&lt;&gt;();</span>

  <span class="kd">private</span> <span class="kd">final</span> <span class="n">FooStats</span> <span class="n">stats</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">Foo</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">stats</span> <span class="o">=</span> <span class="n">STATS</span><span class="o">.</span><span class="na">computeIfAbsent</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="o">(</span><span class="n">i</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="n">FooStats</span><span class="o">(</span><span class="n">i</span><span class="o">));</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doSomething</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">...</span>
    <span class="n">stats</span><span class="o">.</span><span class="na">update</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>This ensures that there is a single copy for a given id. In spectator this
example would look like: </p>
<div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="n">AtomicInteger</span> <span class="n">gauge</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">Counter</span> <span class="n">counter</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">Foo</span><span class="o">(</span><span class="n">Registry</span> <span class="n">registry</span><span class="o">,</span> <span class="n">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Id</span> <span class="n">gaugeId</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="na">createId</span><span class="o">(</span><span class="s">&quot;gauge&quot;</span><span class="o">).</span><span class="na">withTag</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
    <span class="n">gauge</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="na">gauge</span><span class="o">(</span><span class="n">gaugeId</span><span class="o">,</span> <span class="k">new</span> <span class="n">AtomicInteger</span><span class="o">());</span>
    <span class="n">counter</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="na">counter</span><span class="o">(</span><span class="s">&quot;counter&quot;</span><span class="o">,</span> <span class="s">&quot;id&quot;</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doSomething</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">...</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>Everything using the same registry will get the same counter
instance if the same id is used. For the gauge the registry will
keep a weak reference and will sum the values if multiple instances are
present. Since it is a weak reference, nothing will prevent an instance of
<code>Foo</code> from getting garbage collected.</p>
<h3 id="annotations">Annotations<a class="headerlink" href="#annotations" title="Permanent link">&para;</a></h3>
<p>Annotations are not supported, use the appropriate meter type:</p>
<table>
<thead>
<tr>
<th>DataSourceType</th>
<th>Spectator Alternative</th>
</tr>
</thead>
<tbody>
<tr>
<td>COUNTER</td>
<td><a href="../counter/">Counter Usage</a></td>
</tr>
<tr>
<td>GAUGE</td>
<td><a href="../gauge/">Gauge Usage</a></td>
</tr>
<tr>
<td>INFORMATIONAL</td>
<td>Not supported</td>
</tr>
</tbody>
</table>
<h3 id="basiccounter">BasicCounter<a class="headerlink" href="#basiccounter" title="Permanent link">&para;</a></h3>
<p>See the general overview of <a href="#registration">registration differences</a> and
summary of <a href="../counter/">counter usage</a>.</p>
<p>Servo:</p>
<div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Counter</span> <span class="n">c</span> <span class="o">=</span>
    <span class="k">new</span> <span class="n">BasicCounter</span><span class="o">(</span><span class="n">MonitorConfig</span><span class="o">.</span><span class="na">builder</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">).</span><span class="na">build</span><span class="o">());</span>

  <span class="kd">public</span> <span class="nf">Foo</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Monitors</span><span class="o">.</span><span class="na">registerObject</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="k">this</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doSomething</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">c</span><span class="o">.</span><span class="na">increment</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>Spectator:</p>
<div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Counter</span> <span class="n">c</span><span class="o">;</span>

  <span class="nd">@Inject</span>
  <span class="kd">public</span> <span class="nf">Foo</span><span class="o">(</span><span class="n">Registry</span> <span class="n">registry</span><span class="o">,</span> <span class="n">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="na">counter</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">,</span> <span class="s">&quot;id&quot;</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doSomething</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">c</span><span class="o">.</span><span class="na">increment</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<h3 id="basicgauge">BasicGauge<a class="headerlink" href="#basicgauge" title="Permanent link">&para;</a></h3>
<p>See the general overview of <a href="#registration">registration differences</a> and
summary of <a href="../gauge/">gauge usage</a>.</p>
<p>Servo:</p>
<div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">BasicGauge</span> <span class="n">g</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BasicGauge</span><span class="o">(</span>
    <span class="n">MonitorConfig</span><span class="o">.</span><span class="na">builder</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">).</span><span class="na">build</span><span class="o">(),</span>
    <span class="k">this</span><span class="o">::</span><span class="n">getCurrentValue</span><span class="o">);</span>

  <span class="kd">public</span> <span class="nf">Foo</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Monitors</span><span class="o">.</span><span class="na">registerObject</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="k">this</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>Spectator:</p>
<div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="nd">@Inject</span>
  <span class="kd">public</span> <span class="nf">Foo</span><span class="o">(</span><span class="n">Registry</span> <span class="n">registry</span><span class="o">,</span> <span class="n">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Id</span> <span class="n">gaugeId</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="na">createId</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">).</span><span class="na">withTag</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
    <span class="n">registry</span><span class="o">.</span><span class="na">gauge</span><span class="o">(</span><span class="n">gaugeId</span><span class="o">,</span> <span class="k">this</span><span class="o">,</span> <span class="n">Foo</span><span class="o">::</span><span class="n">getCurrentValue</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<h3 id="basictimer">BasicTimer<a class="headerlink" href="#basictimer" title="Permanent link">&para;</a></h3>
<p>See the general overview of <a href="#registration">registration differences</a> and
summary of <a href="../timer/">timer usage</a>. Note in spectator the reported unit
for timers is always seconds and cannot be changed. Seconds is the base unit
and other units should only be used as a presentation detail. Servo allows
the unit to be customized and defaults to milliseconds.</p>
<p>Servo:</p>
<div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Timer</span> <span class="n">t</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BasicTimer</span><span class="o">(</span>
    <span class="n">MonitorConfig</span><span class="o">.</span><span class="na">builder</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">).</span><span class="na">build</span><span class="o">(),</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">);</span>

  <span class="kd">public</span> <span class="nf">Foo</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Monitors</span><span class="o">.</span><span class="na">registerObject</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="k">this</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doSomething</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Stopwatch</span> <span class="n">s</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="o">...</span>
    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
      <span class="n">s</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>Spectator:</p>
<div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Timer</span> <span class="n">t</span><span class="o">;</span>

  <span class="nd">@Inject</span>
  <span class="kd">public</span> <span class="nf">Foo</span><span class="o">(</span><span class="n">Registry</span> <span class="n">registry</span><span class="o">,</span> <span class="n">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="na">timer</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">,</span> <span class="s">&quot;id&quot;</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doSomething</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">t</span><span class="o">.</span><span class="na">record</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
      <span class="o">...</span>
    <span class="o">});</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<h3 id="basicdistributionsummary">BasicDistributionSummary<a class="headerlink" href="#basicdistributionsummary" title="Permanent link">&para;</a></h3>
<p>See the general overview of <a href="#registration">registration differences</a> and
summary of <a href="../dist-summary/">distribution summary usage</a>.</p>
<p>Servo:</p>
<div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">BasicDistributionSummary</span> <span class="n">s</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BasicDistributionSummary</span><span class="o">(</span>
    <span class="n">MonitorConfig</span><span class="o">.</span><span class="na">builder</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">).</span><span class="na">build</span><span class="o">());</span>

  <span class="kd">public</span> <span class="nf">Foo</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Monitors</span><span class="o">.</span><span class="na">registerObject</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="k">this</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doSomething</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">...</span>
    <span class="n">s</span><span class="o">.</span><span class="na">record</span><span class="o">(</span><span class="n">getValue</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>Spectator:</p>
<div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">DistributionSummary</span> <span class="n">s</span><span class="o">;</span>

  <span class="nd">@Inject</span>
  <span class="kd">public</span> <span class="nf">Foo</span><span class="o">(</span><span class="n">Registry</span> <span class="n">registry</span><span class="o">,</span> <span class="n">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="na">distributionSummary</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">,</span> <span class="s">&quot;id&quot;</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doSomething</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">...</span>
    <span class="n">s</span><span class="o">.</span><span class="na">record</span><span class="o">(</span><span class="n">getValue</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<h3 id="basicinformational">BasicInformational<a class="headerlink" href="#basicinformational" title="Permanent link">&para;</a></h3>
<p>Not supported, see <a href="#differences">overview of differences</a>.</p>
<h3 id="basicstopwatch">BasicStopwatch<a class="headerlink" href="#basicstopwatch" title="Permanent link">&para;</a></h3>
<p>There isn't an explicit stopwatch class in spectator. Just use a timing
call directly. </p>
<p>Servo:</p>
<div class="codehilite"><pre><span></span>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doSomething</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Stopwatch</span> <span class="n">s</span> <span class="o">=</span> <span class="n">timer</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="o">...</span>
    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
      <span class="n">s</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>
</pre></div>


<p>Spectator:</p>
<div class="codehilite"><pre><span></span>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doSomething</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="kt">long</span> <span class="n">s</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">nanoTime</span><span class="o">();</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="o">...</span>
    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
      <span class="n">timer</span><span class="o">.</span><span class="na">record</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">nanoTime</span><span class="o">()</span> <span class="o">-</span> <span class="n">s</span><span class="o">,</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">NANOSECONDS</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
</pre></div>


<h3 id="buckettimer">BucketTimer<a class="headerlink" href="#buckettimer" title="Permanent link">&para;</a></h3>
<p>See the general overview of <a href="#registration">registration differences</a> and
summary of <a href="Sandbox">sandbox documentation</a>. Note in spectator BucketTimer is
provided in the sandbox extension library and may change in future as we
gain more experience using it.</p>
<p>Servo:</p>
<div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Timer</span> <span class="n">t</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BucketTimer</span><span class="o">(</span>
    <span class="n">MonitorConfig</span><span class="o">.</span><span class="na">builder</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">).</span><span class="na">build</span><span class="o">(),</span>
    <span class="k">new</span> <span class="n">BucketConfig</span><span class="o">.</span><span class="na">Builder</span><span class="o">()</span>
      <span class="o">.</span><span class="na">withTimeUnit</span><span class="o">(</span><span class="n">TimeUnit</span><span class="o">.</span><span class="na">MILLISECONDS</span><span class="o">)</span>
      <span class="o">.</span><span class="na">withBuckets</span><span class="o">(</span><span class="k">new</span> <span class="kt">long</span><span class="o">[]</span> <span class="o">{</span> <span class="mi">500</span><span class="o">,</span> <span class="mi">2500</span><span class="o">,</span> <span class="mi">5000</span><span class="o">,</span> <span class="mi">10000</span> <span class="o">})</span>
      <span class="o">.</span><span class="na">build</span><span class="o">());</span>

  <span class="kd">public</span> <span class="nf">Foo</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Monitors</span><span class="o">.</span><span class="na">registerObject</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="k">this</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doSomething</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">Stopwatch</span> <span class="n">s</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="o">...</span>
    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
      <span class="n">s</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>Spectator:</p>
<div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Timer</span> <span class="n">t</span><span class="o">;</span>

  <span class="nd">@Inject</span>
  <span class="kd">public</span> <span class="nf">Foo</span><span class="o">(</span><span class="n">Registry</span> <span class="n">registry</span><span class="o">,</span> <span class="n">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Id</span> <span class="n">timerId</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="na">createId</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">,</span> <span class="s">&quot;id&quot;</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
    <span class="n">BucketFunction</span> <span class="n">f</span> <span class="o">=</span> <span class="n">BucketFunctions</span><span class="o">.</span><span class="na">latency</span><span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">);</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">BucketTimer</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">registry</span><span class="o">,</span> <span class="n">timerId</span><span class="o">,</span> <span class="n">f</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doSomething</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">t</span><span class="o">.</span><span class="na">record</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
      <span class="o">...</span>
    <span class="o">});</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<h3 id="contextualcounter">ContextualCounter<a class="headerlink" href="#contextualcounter" title="Permanent link">&para;</a></h3>
<p>Not supported. A fixed tag list for the context is too rigid and this class
was never used much at Netflix. Future work being looked at in
<a href="https://github.com/Netflix/spectator/issues/180">issue-180</a>.</p>
<h3 id="contextualtimer">ContextualTimer<a class="headerlink" href="#contextualtimer" title="Permanent link">&para;</a></h3>
<p>Not supported. A fixed tag list for the context is too rigid and this class
was never used much at Netflix. Future work being looked at in
<a href="https://github.com/Netflix/spectator/issues/180">issue-180</a>.</p>
<h3 id="doublegauge">DoubleGauge<a class="headerlink" href="#doublegauge" title="Permanent link">&para;</a></h3>
<p>See the general overview of <a href="#registration">registration differences</a> and
summary of <a href="../gauge/">gauge usage</a>.</p>
<p>Servo:</p>
<div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">DoubleGauge</span> <span class="n">g</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DoubleGauge</span><span class="o">(</span>
    <span class="n">MonitorConfig</span><span class="o">.</span><span class="na">builder</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">).</span><span class="na">build</span><span class="o">());</span>

  <span class="kd">public</span> <span class="nf">Foo</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Monitors</span><span class="o">.</span><span class="na">registerObject</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="k">this</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>Spectator:</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">com.google.common.util.concurrent.AtomicDouble</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">AtomicDouble</span> <span class="n">v</span><span class="o">;</span>

  <span class="nd">@Inject</span>
  <span class="kd">public</span> <span class="nf">Foo</span><span class="o">(</span><span class="n">Registry</span> <span class="n">registry</span><span class="o">,</span> <span class="n">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Id</span> <span class="n">gaugeId</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="na">createId</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">).</span><span class="na">withTag</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="na">gauge</span><span class="o">(</span><span class="n">gaugeId</span><span class="o">,</span> <span class="k">new</span> <span class="n">AtomicDouble</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<h3 id="durationtimer">DurationTimer<a class="headerlink" href="#durationtimer" title="Permanent link">&para;</a></h3>
<p>See the general overview of <a href="#registration">registration differences</a> and
summary of <a href="../timer/#longtasktimer">timer usage</a>.</p>
<p>Servo:</p>
<div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">DurationTimer</span> <span class="n">t</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DurationTimer</span><span class="o">(</span>
    <span class="n">MonitorConfig</span><span class="o">.</span><span class="na">builder</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">).</span><span class="na">build</span><span class="o">());</span>

  <span class="kd">public</span> <span class="nf">Foo</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Monitors</span><span class="o">.</span><span class="na">registerObject</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="k">this</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>Spectator:</p>
<div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">LongTaskTimer</span> <span class="n">t</span><span class="o">;</span>

  <span class="nd">@Inject</span>
  <span class="kd">public</span> <span class="nf">Foo</span><span class="o">(</span><span class="n">Registry</span> <span class="n">registry</span><span class="o">,</span> <span class="n">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="na">longTaskTimer</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">,</span> <span class="s">&quot;id&quot;</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<h3 id="dynamiccounter">DynamicCounter<a class="headerlink" href="#dynamiccounter" title="Permanent link">&para;</a></h3>
<p>See the general overview of <a href="#registration">registration differences</a> and
summary of <a href="../counter/">counter usage</a>.</p>
<p>Servo:</p>
<div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">id</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">Foo</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doSomething</span><span class="o">(</span><span class="n">Context</span> <span class="n">ctxt</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">DynamicCounter</span><span class="o">.</span><span class="na">increment</span><span class="o">(</span><span class="s">&quot;staticId&quot;</span><span class="o">,</span> <span class="s">&quot;id&quot;</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
    <span class="n">DynamicCounter</span><span class="o">.</span><span class="na">increment</span><span class="o">(</span><span class="s">&quot;dynamicId&quot;</span><span class="o">,</span> <span class="s">&quot;id&quot;</span><span class="o">,</span> <span class="n">id</span><span class="o">,</span> <span class="s">&quot;foo&quot;</span><span class="o">,</span> <span class="n">ctxt</span><span class="o">.</span><span class="na">getFoo</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>Spectator:</p>
<div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Registry</span> <span class="n">registry</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">id</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Counter</span> <span class="n">staticCounter</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Id</span> <span class="n">dynamicId</span><span class="o">;</span>

  <span class="nd">@Inject</span>
  <span class="kd">public</span> <span class="nf">Foo</span><span class="o">(</span><span class="n">Registry</span> <span class="n">registry</span><span class="o">,</span> <span class="n">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">registry</span> <span class="o">=</span> <span class="n">registry</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="n">staticCounter</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="na">counter</span><span class="o">(</span><span class="s">&quot;staticId&quot;</span><span class="o">,</span> <span class="s">&quot;id&quot;</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
    <span class="n">dynamicId</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="na">createId</span><span class="o">(</span><span class="s">&quot;dynamicId&quot;</span><span class="o">,</span> <span class="s">&quot;id&quot;</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doSomething</span><span class="o">(</span><span class="n">Context</span> <span class="n">ctxt</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// Keeping the reference to the counter avoids additional allocations</span>
    <span class="c1">// to create the id object and the lookup cost</span>
    <span class="n">staticCounter</span><span class="o">.</span><span class="na">increment</span><span class="o">();</span>

    <span class="c1">// If the id is dynamic it must be looked up</span>
    <span class="n">registry</span><span class="o">.</span><span class="na">counter</span><span class="o">(</span><span class="s">&quot;dynamicId&quot;</span><span class="o">,</span> <span class="s">&quot;id&quot;</span><span class="o">,</span> <span class="n">id</span><span class="o">,</span> <span class="s">&quot;foo&quot;</span><span class="o">,</span> <span class="n">ctxt</span><span class="o">.</span><span class="na">getFoo</span><span class="o">()).</span><span class="na">increment</span><span class="o">();</span>

    <span class="c1">// This will update the same counter as the line above, but the base part</span>
    <span class="c1">// of the id is precomputed to make it cheaper to construct the id.</span>
    <span class="n">registry</span><span class="o">.</span><span class="na">counter</span><span class="o">(</span><span class="n">dynamicId</span><span class="o">.</span><span class="na">withTag</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">,</span> <span class="n">ctxt</span><span class="o">.</span><span class="na">getFoo</span><span class="o">())).</span><span class="na">increment</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<h3 id="dynamictimer">DynamicTimer<a class="headerlink" href="#dynamictimer" title="Permanent link">&para;</a></h3>
<p>See the general overview of <a href="#registration">registration differences</a> and
summary of <a href="../timer/">timer usage</a>.</p>
<p>Servo:</p>
<div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">id</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">MonitorConfig</span> <span class="n">staticId</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">Foo</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="n">staticId</span> <span class="o">=</span> <span class="n">MonitorConfig</span><span class="o">.</span><span class="na">builder</span><span class="o">(</span><span class="s">&quot;staticId&quot;</span><span class="o">).</span><span class="na">withTag</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">,</span> <span class="n">id</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doSomething</span><span class="o">(</span><span class="n">Context</span> <span class="n">ctxt</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="kt">long</span> <span class="n">d</span> <span class="o">=</span> <span class="n">ctxt</span><span class="o">.</span><span class="na">getDurationMillis</span><span class="o">();</span>
    <span class="n">DynamicTimer</span><span class="o">.</span><span class="na">record</span><span class="o">(</span><span class="n">staticId</span><span class="o">,</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">,</span> <span class="n">d</span><span class="o">,</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">MILLISECONDS</span><span class="o">);</span>

    <span class="n">MonitorConfig</span> <span class="n">dynamicId</span> <span class="o">=</span> <span class="n">MonitorConfig</span><span class="o">.</span><span class="na">builder</span><span class="o">(</span><span class="s">&quot;dynamicId&quot;</span><span class="o">)</span>
      <span class="o">.</span><span class="na">withTag</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">,</span> <span class="n">id</span><span class="o">)</span>
      <span class="o">.</span><span class="na">withTag</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">,</span> <span class="n">ctxt</span><span class="o">.</span><span class="na">getFoo</span><span class="o">())</span>
      <span class="o">.</span><span class="na">build</span><span class="o">();</span>
    <span class="n">DynamicTimer</span><span class="o">.</span><span class="na">record</span><span class="o">(</span><span class="n">dynamicId</span><span class="o">,</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">,</span> <span class="n">d</span><span class="o">,</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">MILLISECONDS</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>Spectator:</p>
<div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Registry</span> <span class="n">registry</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">id</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Timer</span> <span class="n">staticTimer</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Id</span> <span class="n">dynamicId</span><span class="o">;</span>

  <span class="nd">@Inject</span>
  <span class="kd">public</span> <span class="nf">Foo</span><span class="o">(</span><span class="n">Registry</span> <span class="n">registry</span><span class="o">,</span> <span class="n">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">registry</span> <span class="o">=</span> <span class="n">registry</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="n">staticTimer</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="na">timer</span><span class="o">(</span><span class="s">&quot;staticId&quot;</span><span class="o">,</span> <span class="s">&quot;id&quot;</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
    <span class="n">dynamicId</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="na">createId</span><span class="o">(</span><span class="s">&quot;dynamicId&quot;</span><span class="o">,</span> <span class="s">&quot;id&quot;</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doSomething</span><span class="o">(</span><span class="n">Context</span> <span class="n">ctxt</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="kt">long</span> <span class="n">d</span> <span class="o">=</span> <span class="n">ctxt</span><span class="o">.</span><span class="na">getDurationMillis</span><span class="o">();</span>

    <span class="c1">// Keeping the reference to the timer avoids additional allocations</span>
    <span class="c1">// to create the id object and the lookup cost</span>
    <span class="n">staticTimer</span><span class="o">.</span><span class="na">record</span><span class="o">(</span><span class="n">d</span><span class="o">,</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">MILLISECONDS</span><span class="o">);</span>

    <span class="c1">// If the id is dynamic it must be looked up</span>
    <span class="n">registry</span><span class="o">.</span><span class="na">timer</span><span class="o">(</span><span class="s">&quot;dynamicId&quot;</span><span class="o">,</span> <span class="s">&quot;id&quot;</span><span class="o">,</span> <span class="n">id</span><span class="o">,</span> <span class="s">&quot;foo&quot;</span><span class="o">,</span> <span class="n">ctxt</span><span class="o">.</span><span class="na">getFoo</span><span class="o">())</span>
      <span class="o">.</span><span class="na">record</span><span class="o">(</span><span class="n">d</span><span class="o">,</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">MILLISECONDS</span><span class="o">);</span>

    <span class="c1">// This will update the same timer as the line above, but the base part</span>
    <span class="c1">// of the id is precomputed to make it cheaper to construct the id.</span>
    <span class="n">registry</span><span class="o">.</span><span class="na">timer</span><span class="o">(</span><span class="n">dynamicId</span><span class="o">.</span><span class="na">withTag</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">,</span> <span class="n">ctxt</span><span class="o">.</span><span class="na">getFoo</span><span class="o">()))</span>
      <span class="o">.</span><span class="na">record</span><span class="o">(</span><span class="n">d</span><span class="o">,</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">MILLISECONDS</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<h3 id="longgauge">LongGauge<a class="headerlink" href="#longgauge" title="Permanent link">&para;</a></h3>
<p>See the general overview of <a href="#registration">registration differences</a> and
summary of <a href="../gauge/">gauge usage</a>.</p>
<p>Servo:</p>
<div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">LongGauge</span> <span class="n">g</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LongGauge</span><span class="o">(</span>
    <span class="n">MonitorConfig</span><span class="o">.</span><span class="na">builder</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">).</span><span class="na">build</span><span class="o">());</span>

  <span class="kd">public</span> <span class="nf">Foo</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Monitors</span><span class="o">.</span><span class="na">registerObject</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="k">this</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>Spectator:</p>
<div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">AtomicLong</span> <span class="n">v</span><span class="o">;</span>

  <span class="nd">@Inject</span>
  <span class="kd">public</span> <span class="nf">Foo</span><span class="o">(</span><span class="n">Registry</span> <span class="n">registry</span><span class="o">,</span> <span class="n">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Id</span> <span class="n">gaugeId</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="na">createId</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">).</span><span class="na">withTag</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="na">gauge</span><span class="o">(</span><span class="n">gaugeId</span><span class="o">,</span> <span class="k">new</span> <span class="n">AtomicLong</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<h3 id="monitorconfig">MonitorConfig<a class="headerlink" href="#monitorconfig" title="Permanent link">&para;</a></h3>
<p>See the documentation on <a href="../conventions/">naming</a>.</p>
<p>Servo:</p>
<div class="codehilite"><pre><span></span><span class="n">MonitorConfig</span> <span class="n">id</span> <span class="o">=</span> <span class="n">MonitorConfig</span><span class="o">.</span><span class="na">builder</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">withTag</span><span class="o">(</span><span class="s">&quot;country&quot;</span><span class="o">,</span> <span class="s">&quot;US&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">withTag</span><span class="o">(</span><span class="s">&quot;device&quot;</span><span class="o">,</span>  <span class="s">&quot;xbox&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</pre></div>


<p>Spectator:</p>
<div class="codehilite"><pre><span></span><span class="n">Id</span> <span class="n">id</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="na">createId</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">withTag</span><span class="o">(</span><span class="s">&quot;country&quot;</span><span class="o">,</span> <span class="s">&quot;US&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">withTag</span><span class="o">(</span><span class="s">&quot;device&quot;</span><span class="o">,</span>  <span class="s">&quot;xbox&quot;</span><span class="o">);</span>

<span class="c1">// or</span>

<span class="n">Id</span> <span class="n">id</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="na">createId</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">,</span> <span class="s">&quot;country&quot;</span><span class="o">,</span> <span class="s">&quot;US&quot;</span><span class="o">,</span> <span class="s">&quot;device&quot;</span><span class="o">,</span> <span class="s">&quot;xbox&quot;</span><span class="o">);</span>
</pre></div>


<h3 id="monitoredcache">MonitoredCache<a class="headerlink" href="#monitoredcache" title="Permanent link">&para;</a></h3>
<p>Not supported because spectator does not have a direct dependency on guava.
If there is enough demand an extension can be created.</p>
<h3 id="numbergauge">NumberGauge<a class="headerlink" href="#numbergauge" title="Permanent link">&para;</a></h3>
<p>See the general overview of <a href="#registration">registration differences</a> and
summary of <a href="../gauge/">gauge usage</a>.</p>
<p>Servo:</p>
<div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">NumberGauge</span> <span class="n">g</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NumberGauge</span><span class="o">(</span>
    <span class="n">MonitorConfig</span><span class="o">.</span><span class="na">builder</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">).</span><span class="na">build</span><span class="o">(),</span> <span class="k">new</span> <span class="n">AtomicLong</span><span class="o">());</span>

  <span class="kd">public</span> <span class="nf">Foo</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Monitors</span><span class="o">.</span><span class="na">registerObject</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="k">this</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>Spectator:</p>
<div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">AtomicLong</span> <span class="n">v</span><span class="o">;</span>

  <span class="nd">@Inject</span>
  <span class="kd">public</span> <span class="nf">Foo</span><span class="o">(</span><span class="n">Registry</span> <span class="n">registry</span><span class="o">,</span> <span class="n">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Id</span> <span class="n">gaugeId</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="na">createId</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">).</span><span class="na">withTag</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="na">gauge</span><span class="o">(</span><span class="n">gaugeId</span><span class="o">,</span> <span class="k">new</span> <span class="n">AtomicLong</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<h3 id="statstimer">StatsTimer<a class="headerlink" href="#statstimer" title="Permanent link">&para;</a></h3>
<p>Not supported, see <a href="#differences">overview of differences</a>.</p>
<h3 id="stepcounter">StepCounter<a class="headerlink" href="#stepcounter" title="Permanent link">&para;</a></h3>
<p>See the general overview of <a href="#registration">registration differences</a> and
summary of <a href="../counter/">counter usage</a>.</p>
<p>Servo:</p>
<div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Counter</span> <span class="n">c</span> <span class="o">=</span>
    <span class="k">new</span> <span class="n">StepCounter</span><span class="o">(</span><span class="n">MonitorConfig</span><span class="o">.</span><span class="na">builder</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">).</span><span class="na">build</span><span class="o">());</span>

  <span class="kd">public</span> <span class="nf">Foo</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Monitors</span><span class="o">.</span><span class="na">registerObject</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="k">this</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doSomething</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">c</span><span class="o">.</span><span class="na">increment</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>Spectator:</p>
<div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Foo</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Counter</span> <span class="n">c</span><span class="o">;</span>

  <span class="nd">@Inject</span>
  <span class="kd">public</span> <span class="nf">Foo</span><span class="o">(</span><span class="n">Registry</span> <span class="n">registry</span><span class="o">,</span> <span class="n">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="na">counter</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">,</span> <span class="s">&quot;id&quot;</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doSomething</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">c</span><span class="o">.</span><span class="na">increment</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../netflix/" title="Netflix Integration" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Netflix Integration
              </span>
            </div>
          </a>
        
        
          <a href="../../ext/jvm-buffer-pools/" title="Buffer Pools" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Buffer Pools
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.583bbe55.js"></script>
      
      <script>app.initialize({version:"1.0",url:{base:"../.."}})</script>
      
    
    
      
        <script>!function(e,a,t,n,o,c,i){e.GoogleAnalyticsObject=o,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),i=a.getElementsByTagName(t)[0],c.async=1,c.src="https://www.google-analytics.com/analytics.js",i.parentNode.insertBefore(c,i)}(window,document,"script",0,"ga"),ga("create","UA-82153845-2","auto"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");if(Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var a=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",a,e.href)})}),document.forms.search){var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}</script>
      
    
  </body>
</html>